{% extends "shopapp/../base.html" %}
{% load static %}
{% block links %}
    <link rel="stylesheet" href="{% static "css/book.css" %}">
{% endblock %}
{% block main %}
    <main>
        <h1>Single book</h1>
        <section id="single-book">
            <figure>
                <img class="book-cover" src="/static/img/{{ book.img }}" alt="book title">
                <figcaption>{{ book.author }}</figcaption>
            </figure>
            <p>{{ book.description }}</p>
            <h4>Available in stock: {{ book.stock }}</h4>
            <h3>Price: ${{ book.price }}</h3>
            <h1>book id: {{ book.id }}</h1>
            {% if book.read == True %}
                <form action="/">
                    <input type="submit" value="Read online">
                </form>
            {% endif %}
        
            <button class="add-to-cart" data-book-id="{{ book.id }}">Add to Cart</button>
    
            <script>
                document.querySelectorAll('.add-to-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const bookId = this.getAttribute('data-book-id');
                         if (!bookId) {
                            console.error('Book ID is not defined');
                            return;
                        }
                        fetch("{% url 'add-to-cart' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            body: 'book_id=' + bookId + '&quantity=1'
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                alert('Book added to cart!');
                                // Update cart display or redirect to cart page here
                            } else {
                                alert('Error: ' + data.message);
                            }
                        })
                        .catch(error => console.error('Error:', error));

                    });
                });
            </script>

        </section>
    </main>
{% endblock %}